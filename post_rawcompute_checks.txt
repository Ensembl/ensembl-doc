Post rawcompute checks
---- ---------- ------

SCP - 03 04 2002

This document describes the steps that we currently take to check data
from the raw computes. Where possible I've included sample sql or perl
that should test for these things.

These are the steps that currently need to be taken before a pipeline
database is handed over to the genebuild team:


1. Check that all features (including repeat features) have
sensible start and end coords:

  select * from simple_feature where contig_start > contig_end;
  select * from dna_align_feature where hit_start > hit_end;	

2. all features have an entry in analysisprocess with a
unique and consistent (i.e. same as last release) logic_name.


3. Check that the analysis table is as complete as possible,
including entries in the 'db' column - even when this clearly
does not make sense :-) References to files should be valid.

For example, the STS file for ePCR and the appropriate maps
database/tables should be in sync. The STS file should be named
appropriately, e.g. not "jimbos_favourite_human_markers.dat"!


4. There should be no dangling features (i.e. all link to a
raw contig)

  select sf.id
  from   simple_feature sf left join contig
  on     feature.contig_id = contig.contig_id
  where  contig.contig_id is null


5. There should not be any entries in the analysis table (except
things like 'SubmitContig') unless there are features present with
that analysis ID.


6. Check that genscan predictions translate - using some code like,
for example:

  my $dbh = Bio::EnsEMBL::DBSQL::DBAdaptor(...);
  foreach $id (e.g. $dbh->get_all_Contigs - or supply a list of IDs) {
    my $contig = $dbh->get_Contig($id);
    eval {
      foreach my $transc ($contig->get_genscan_peptides) {
	$t = $transc->translate;
      }
    };
    if ($@) {
      print "nasty contig $id\n";
    }
  }


7. Check that blast DB accessions are correct, though it is possibly
a bit late for this and I'd be seriously annoyed if this one ever
rears its ugly head again :-)


8. Check for outright duplications - same feature bar the internal
feature ID (this happens when jobs get restarted) and delete them.


9. If necessary, prune features by whatever criterion is flavour of
the month with the genebuild team. A common request is to remove
features with bit score < 150.


10. Check that analyses done on golden path regions/denormalized
contigs (such as ePCR) are run. No compute should be outstanding
once the database is handed over.

