Golden path loading HOW-TO

SCP (April '01)


A) Overview

This is relatively straight forward. Loading a golden path involves
only a few steps. The problems occur when there are mismatches between
the clones (and versions) on the golden path and in the ensembl
database. Those clones will generally need to be loaded with the
correct version and/or have their contig split checked.

B) Scripts

The scripts for all of this are in ensembl/misc-scripts/golden_path
(GP loading and checking) and ensembl/scripts (loading clones from ffa
and fasta files).

ensembl/misc-scripts/golden_path ("$scripts"):
  mergefpcchr.pl  - merge contig and chromosome files
  fpc2staticgp.pl - build static golden path
  makeunique.pl   - check for unique raw contig IDs
ensembl/scripts directory:
  ffa2ensembl     - load ensembl clones from Greg's ffa files
  raw2ensembl     - load ensembl clones from fasta files


C) Files

The golden path comes in two zip files, contigAgp.zip and chromAgp.zip.
The location of these will be communicated by Jim Kent when the golden
path is ready. You will also find numerous fasta and ffa files relating
to the golden path on the web site.


D) Database

The clones are currently stored in the live human database, 'human_live'
on ecs1a. This is updated daily from the embl files which are mirrored
in /scratch2/ensembl/enspipe/embl_feed. You should check the golden path
against the clones in this database, which should be 'complete'.


E) Procedure

1. make a working directory (in a scratch area) for the GP

    mkdir /$scratchdir/april_gp

2. make dirs for the chromosome and contig files

    cd /scratch/april_gp
    mkdir chromo contig

3. get the files chromAgp.zip and contigAgp.zip and unpack

    cd chromo
    wget www.../chromAgp.zip
    unzip chromAgp.zip
    cd ../contig
    wget www.../contigAgp.zip
    unzip contigAgp.zip
    cd ..

4. Merge the contig and chromosome files

Jim K's directory structure is
  chr-directory/chr_XXX_YYY.agp (chromosomes)
  contig-directory/chr_XXX/ctgZZZ/ctgZZZ.agp (contigs)

These files need to be merged.

    perl $scripts/mergefpcchr.pl chromo/ contig/

This script creates inside chromo a set of *.fpc files. These are
similar to the .agp files but with the inclusion of the fpc contigs.

5. Get a list of contigs from the current database

    SELECT id, internal_id, offset, length
    FROM   contig
    INTO   OUTFILE '/tmp/contig.txt'

6. Generate the static golden path table

    perl $scripts/fpc2staticgp contig.txt chromo/*.fpc > static.txt

This will print on stderr a list of problem clones, e.g. those
required but not in the DB and those for which the split is not the
same. This info is also written into parse.log. The file idlist.txt
contains a list of ensembl rawcontig IDs/internal IDs in the GP.

The clones which present a problem need to be examined - this will
probably mean loading clones with the correct version for the GP or
reloading clones from Greg's ffa files with a different contig split.
(N.B. The raw computes will need to be run on those clones.)

7. Check for unique raw_contigs in the golden path

    perl $scripts/makeunique.pl < static.txt > ! static_unq.txt

Errors at this stage could be due to the placing of the same raw contig
on more than one chromosome. These problems need to be communicated
to Jim.

8. Congratulations! You have a golden path.

Load the path into the ensembl. The tab delimited file in static_unq.txt
can be loaded directly into the static golden table.
